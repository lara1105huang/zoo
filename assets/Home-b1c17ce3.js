import{E as ue,a as ie,b as de,c as ce}from"./el-input-b549b1f1.js";import{E as ve}from"./el-overlay-79d402ef.js";import{u as G,r as f,g as B,h as me,i as fe,j as E,k as x,l as D,b as m,v as H,T as ge,m as A,n as pe,p as Z,q as z,s as he,x as $,y as O,z as J,A as _e,B as be,d as Ce,C as w,D as ye,o as xe,a as I,c as S,e as t,E as ke,F as Le,G as we,t as _,w as Ve,H as L,I as Ee,J as $e}from"./index-837c2d33.js";import{m as Ie,a as Se,b as Te,c as Ne,F as Be}from"./main-5011130d.js";import"./firebaseConfig-6dde66e2.js";import"./focus-trap-5081f37f.js";function Ae(l){let e;const s=G("loading"),u=f(!1),o=B({...l,originalPosition:"",originalOverflow:"",visible:!1});function i(n){o.text=n}function g(){const n=o.parent;if(!n.vLoadingAddClassList){let C=n.getAttribute("loading-number");C=Number.parseInt(C)-1,C?n.setAttribute("loading-number",C.toString()):(A(n,s.bm("parent","relative")),n.removeAttribute("loading-number")),A(n,s.bm("parent","hidden"))}b(),k.unmount()}function b(){var n,C;(C=(n=v.$el)==null?void 0:n.parentNode)==null||C.removeChild(v.$el)}function y(){var n;l.beforeClose&&!l.beforeClose()||(u.value=!0,clearTimeout(e),e=window.setTimeout(c,400),o.visible=!1,(n=l.closed)==null||n.call(l))}function c(){if(!u.value)return;const n=o.parent;u.value=!1,n.vLoadingAddClassList=void 0,g()}const k=me({name:"ElLoading",setup(){return()=>{const n=o.spinner||o.svg,C=E("svg",{class:"circular",viewBox:o.svgViewBox?o.svgViewBox:"0 0 50 50",...n?{innerHTML:n}:{}},[E("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),p=o.text?E("p",{class:s.b("text")},[o.text]):void 0;return E(ge,{name:s.b("fade"),onAfterLeave:c},{default:x(()=>[D(m("div",{style:{backgroundColor:o.background||""},class:[s.b("mask"),o.customClass,o.fullscreen?"is-fullscreen":""]},[E("div",{class:s.b("spinner")},[C,p])]),[[H,o.visible]])])})}}}),v=k.mount(document.createElement("div"));return{...fe(o),setText:i,removeElLoadingChild:b,close:y,handleAfterLeave:c,vm:v,get $el(){return v.$el}}}let N;const F=function(l={}){if(!pe)return;const e=De(l);if(e.fullscreen&&N)return N;const s=Ae({...e,closed:()=>{var o;(o=e.closed)==null||o.call(e),e.fullscreen&&(N=void 0)}});Fe(e,e.parent,s),U(e,e.parent,s),e.parent.vLoadingAddClassList=()=>U(e,e.parent,s);let u=e.parent.getAttribute("loading-number");return u?u=`${Number.parseInt(u)+1}`:u="1",e.parent.setAttribute("loading-number",u),e.parent.appendChild(s.$el),Z(()=>s.visible.value=e.visible),e.fullscreen&&(N=s),s},De=l=>{var e,s,u,o;let i;return z(l.target)?i=(e=document.querySelector(l.target))!=null?e:document.body:i=l.target||document.body,{parent:i===document.body||l.body?document.body:i,background:l.background||"",svg:l.svg||"",svgViewBox:l.svgViewBox||"",spinner:l.spinner||!1,text:l.text||"",fullscreen:i===document.body&&((s=l.fullscreen)!=null?s:!0),lock:(u=l.lock)!=null?u:!1,customClass:l.customClass||"",visible:(o=l.visible)!=null?o:!0,target:i}},Fe=async(l,e,s)=>{const{nextZIndex:u}=he(),o={};if(l.fullscreen)s.originalPosition.value=$(document.body,"position"),s.originalOverflow.value=$(document.body,"overflow"),o.zIndex=u();else if(l.parent===document.body){s.originalPosition.value=$(document.body,"position"),await Z();for(const i of["top","left"]){const g=i==="top"?"scrollTop":"scrollLeft";o[i]=`${l.target.getBoundingClientRect()[i]+document.body[g]+document.documentElement[g]-Number.parseInt($(document.body,`margin-${i}`),10)}px`}for(const i of["height","width"])o[i]=`${l.target.getBoundingClientRect()[i]}px`}else s.originalPosition.value=$(e,"position");for(const[i,g]of Object.entries(o))s.$el.style[i]=g},U=(l,e,s)=>{const u=G("loading");["absolute","fixed","sticky"].includes(s.originalPosition.value)?A(e,u.bm("parent","relative")):O(e,u.bm("parent","relative")),l.fullscreen&&l.lock?O(e,u.bm("parent","hidden")):A(e,u.bm("parent","hidden"))},R=Symbol("ElLoading"),j=(l,e)=>{var s,u,o,i;const g=e.instance,b=v=>J(e.value)?e.value[v]:void 0,y=v=>{const n=z(v)&&(g==null?void 0:g[v])||v;return n&&f(n)},c=v=>y(b(v)||l.getAttribute(`element-loading-${be(v)}`)),V=(s=b("fullscreen"))!=null?s:e.modifiers.fullscreen,k={text:c("text"),svg:c("svg"),svgViewBox:c("svgViewBox"),spinner:c("spinner"),background:c("background"),customClass:c("customClass"),fullscreen:V,target:(u=b("target"))!=null?u:V?void 0:l,body:(o=b("body"))!=null?o:e.modifiers.body,lock:(i=b("lock"))!=null?i:e.modifiers.lock};l[R]={options:k,instance:F(k)}},Re=(l,e)=>{for(const s of Object.keys(e))_e(e[s])&&(e[s].value=l[s])},M={mounted(l,e){e.value&&j(l,e)},updated(l,e){const s=l[R];e.oldValue!==e.value&&(e.value&&!e.oldValue?j(l,e):e.value&&e.oldValue?J(e.value)&&Re(e.value,s.options):s==null||s.instance.close())},unmounted(l){var e;(e=l[R])==null||e.instance.close()}},Me={install(l){l.directive("loading",M),l.config.globalProperties.$loading=F},directive:M,service:F};const Pe={class:"home"},qe={class:"calendar_area"},Oe=t("div",{class:"headline"},"認識動物課程",-1),Ue=t("div",{class:"words"},null,-1),je=t("i",{class:"fa-solid fa-magnifying-glass"},null,-1),Ge={class:"teachers_info"},He=t("div",{class:"headline"},"可愛動物列表",-1),Ze=t("thead",null,[t("tr",null,[t("td",null,"pic"),t("td",null,"姓名"),t("td",null,"出生日期"),t("td",null,"電子郵件"),t("td",null,"行動電話"),t("td")])],-1),ze=["onClick"],Je=["src"],Ke={class:"loveCount_area"},We=["onClick"],Ye={key:0,class:"loveCount_data"},Qe={key:1,class:"loveCount_data"},Xe={class:"delDialog"},el={class:"sure"},ll={class:"info"},tl=t("span",{class:"title"},"課程主題",-1),sl=t("span",{class:"teacher"},"指導老師",-1),al=t("span",{class:"teacher"},"積分",-1),ol=t("span",{class:"allday"},"全天",-1),nl=t("span",{class:"start"},"開始時間",-1),rl=t("span",{class:"end"},"結束時間",-1),ul=t("span",null,"課程描述",-1),il={class:"info_content"},dl={class:"btn_area"},hl=Ce({__name:"Home",setup(l){const e=f(),s=Ee(),u=w.database().ref("schedules/"),o=f([]),i=f([]),g=f(""),b=f(""),y=f(!1),c=f({}),V=w.database().ref("teachers/"),k=f([]),v=f(!1),n=B({search:""}),C=B({search:[{required:!0,message:"搜尋不能空！",trigger:"blur"}]}),p=f({name:"",phone:"",email:""}),K=B({name:[{required:!0,message:"課程主題不能為空！",trigger:"change"},{min:2,max:30,message:"長度2~30個字符之間",trigger:"blur"}],phone:[{required:!0,message:"行動電話不能為空！",trigger:"change"},{min:10,max:10,message:"行動電話10個數字",trigger:"blur"}],email:[{required:!0,message:"電子郵件不能為空",trigger:"change"},{type:"email",required:!0,message:"電子郵件格式不正確",trigger:"blur"}]}),W=r=>{if(console.log(),r.loveCount==null){r.loveCount=0;const a=r.loveCount++;w.database().ref("teachers/"+r.id+"/loveCount").set(a)}else{const a=r.loveCount++;w.database().ref("teachers/"+r.id+"/loveCount").set(a)}},Y=r=>{let a={id:Math.floor(Date.now()/1e3),subject:r.title,curriculumId:r.id,teacherName:r.teacherName,start:r.start,end:r.end,orderName:p.value.name,orderPhone:p.value.phone,orderEmail:p.value.email};w.database().ref("orders/"+a.id).set(a),y.value=!1,y.value==!1&&$e({message:"訂閱成功！",type:"success"})},Q=r=>{y.value=!0,g.value=r.event.title,b.value=r.event.id,w.database().ref("schedules/"+b.value).once("value",h=>{c.value=h.val()})},X=()=>{const r=Me.service({lock:!0,text:"Loading",background:"rgba(0, 0, 0, 0.7)"});u.once("value",a=>{o.value=a.val(),a.forEach(h=>{i.value.push(h.val()),r.close()})})},ee=()=>{V.once("value",r=>{r.forEach(a=>{k.value.push(a.val())})})};f({});const le=r=>{localStorage.setItem("teacherId",r),s.push(`teacher/${r}`)},te=ye(()=>{var r=i.value;let a=n.search;return a===""||(a=a.trim().toLowerCase(),r=r.filter(h=>{if(console.log(h),h.title.toLowerCase().indexOf(a)!==-1)return h})),r}),se=f({timeZone:"UTC",plugins:[Ie,Se,Te,Ne],headerToolbar:{left:"prev",center:"title",right:"next"},initialView:window.screen.width<767?"listWeek":"dayGridMonth",height:(window.screen.width<767,800),events:te,eventTimeFormat:{hour:"2-digit",minute:"2-digit",hour12:!1},eventClick:Q,editable:!1,droppable:!1,selectable:!0,selectMirror:!0,dayMaxEvents:!0,weekends:!0});return xe(()=>{X(),ee()}),(r,a)=>{const h=ue,T=ie,P=de,q=ce,ae=ve,oe=M;return D((I(),S("div",Pe,[t("div",qe,[Oe,m(P,{ref_key:"ruleFormRef",ref:e,model:n,rules:C,class:"search-ruleForm","status-icon":""},{default:x(()=>[Ue,m(T,{class:"search",prop:"search"},{default:x(()=>[m(h,{modelValue:n.search,"onUpdate:modelValue":a[0]||(a[0]=d=>n.search=d),modelModifiers:{trim:!0}},null,8,["modelValue"]),je]),_:1})]),_:1},8,["model","rules"]),m(ke(Be),{options:se.value},null,8,["options"])]),t("div",Ge,[He,t("table",null,[Ze,t("tbody",null,[(I(!0),S(Le,null,we(k.value,(d,ne)=>(I(),S("tr",{key:ne,onClick:re=>le(d.id)},[t("td",null,[t("div",null,[t("img",{src:d.picture},null,8,Je)])]),t("td",null,_(d.name)+" 老師",1),t("td",null,_(d.birthday),1),t("td",null,_(d.email),1),t("td",null,_(d.phone),1),t("td",null,[t("span",Ke,[t("i",{onClick:Ve(re=>W(d),["stop"]),class:"fa-regular fa-heart"},null,8,We),d.loveCount==null?(I(),S("span",Ye,"0")):(I(),S("span",Qe,_(d.loveCount),1))])])],8,ze))),128))])])]),m(ae,{class:"openDelScheduleDialog",modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=d=>y.value=d),title:"訂閱課程"},{default:x(()=>[t("div",Xe,[t("div",el,[t("b",null,"你確定要訂閱"+_(g.value),1)]),t("div",ll,[t("div",null,[tl,L(_(c.value.title),1)]),t("div",null,[sl,L(_(c.value.teacherName),1)]),t("div",null,[al,L(" "+_(c.value.integral),1)]),D(t("div",null,[ol,L("是")],512),[[H,c.value.allDay]]),t("div",null,[nl,L(_(c.value.start),1)]),t("div",null,[rl,L(_(c.value.end),1)]),ul,t("div",il,_(c.value.content),1)]),m(P,{ref:"ruleOrderFormRef",model:p.value,rules:K},{default:x(()=>[m(T,{label:"訂課人姓名",prop:"name"},{default:x(()=>[m(h,{modelValue:p.value.name,"onUpdate:modelValue":a[1]||(a[1]=d=>p.value.name=d),placeholder:"請輸入你的姓名"},null,8,["modelValue"])]),_:1}),m(T,{label:"電話",prop:"phone"},{default:x(()=>[m(h,{modelValue:p.value.phone,"onUpdate:modelValue":a[2]||(a[2]=d=>p.value.phone=d),placeholder:"請輸入你的電話"},null,8,["modelValue"])]),_:1}),m(T,{label:"email",prop:"email"},{default:x(()=>[m(h,{modelValue:p.value.email,"onUpdate:modelValue":a[3]||(a[3]=d=>p.value.email=d),placeholder:"請輸入你的電子郵件"},null,8,["modelValue"])]),_:1}),t("div",dl,[m(q,{class:"btn_cancel",onClick:a[4]||(a[4]=d=>y.value=!1)},{default:x(()=>[L("取消")]),_:1}),m(q,{onClick:a[5]||(a[5]=d=>Y(c.value)),class:"addSave"},{default:x(()=>[L("選課")]),_:1})])]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])])),[[oe,v.value,void 0,{fullscreen:!0,lock:!0}]])}}});export{hl as default};
